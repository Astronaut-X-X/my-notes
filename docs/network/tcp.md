---
lang: zh-CN
title: TCP
description: TCP
---

# TCP

TCP 传输控制协议(Transmission Control Protocal),是一种面向连接的、可靠的、基于字节流的传输层控制协议。最早由[RFC 793](https://www.rfc-editor.org/rfc/rfc793) 决议定义，如今已近在[RFC 9293](https://www.rfc-editor.org/rfc/rfc9293#name-status-of-this-memo)中被重新定义。

TCP 面向连接 指的是 TCP是通过3次握手、4次挥手创建的TCP连接。
3次握手的具体流程如下：
1、由客户端发出建立请求数据报 
2、由服务端接收到数据包后返回响应
3、客户端再次接收到响应数据报后，返回响应
建立TCP连接，

注意点：
TCP连接是建立在IP协议之上的，也就是说，没次TCP的数据报传输过程中通过的数据链路可能不相同。
TCP长连接是通过双方维持一个Sokcet保持的，Socket分别记录了对方和本机的IP地址和端口号。

数据包构成
|            |        |         |          |          |
| ---------- | ------ | ------- | -------- | -------- |
|            |        |         | 用户头部 | 用户数据 |
|            |        | TCP首部 | 应用数据 | 应用数据 |
|            | IP首部 | TCP首部 | 应用数据 | 应用数据 |
| 以太网首部 | IP首部 | TCP首部 | 应用数据 | 应用数据 |

TCP 三次握手、四次挥手
+ 确认是双工、保证可靠性

为什么 time_wait 需要等待 2MSL
+ MSL： Maximum Segment Lifetime，30s - 1min
+ 保证TCP协议的全双工连接能够可靠关闭
+ 保证这次连接的重复数据段从网络中消失

TCP为什么需要流量控制（UDP） 
+ 由于通讯双方，网速不同。通讯方任意一方发送过快都会导致对方消息处理不过来，所以就需要把数据存储到缓冲区中
+ 如果缓冲区满了，发送方还在疯狂发送，那接收方只能把数据包丢弃，因此我们需要控制发送速率
+ 我们缓冲区的剩余大小称之为接受窗口

TCP为什么需要拥塞控制
+ 慢开始和拥塞避免
+ 快重传和快恢复


